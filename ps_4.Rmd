---
title: "Problem Set #4"
author: "Mike Silva"
date: "2/26/2019"
output: html_document
---

```{r setup, include=FALSE}
library(tidyverse)
library(janitor)
library(stringr)
library(ggplot2)
library(gt)
library(tidyr)
```

```{r, include=FALSE}
#load the data
x <- read_csv("ps_4_elections-poll-nc09-3.csv")
```

```{r, include=FALSE}
 #filtered the table to show who did or didn't vote for Democrats and then counted the ones that did with count()
a <- x %>%
  filter(response == "Dem") %>%
  count(TRUE)


b <- x %>%
  #selected response to specify what I was looking at
  select(response) %>% 
  #grouped by response and counted to get numbers associated with each response
  group_by(response) %>% 
  summarise(n=n())

c <- x %>%
 #filtered for when gender observations didn't match gender_combined observations
   filter( gender != gender_combined) %>% 
  #used nrow() to count the difference
  nrow()

d <- x %>% 
  #selected both columns the question discusses
  select(race_eth, file_race_black) %>%
  #used same filter process as last quesiton, this time specifying that race_eth is only showing "white" observations.
  filter(race_eth == "White", race_eth != file_race_black) %>%  
  nrow()
d

e <- x %>%
  #narrowed table down to just timestamp and their responses
  select(timestamp, response) %>%
  #arranged the timestamp variable and since I selected response, it shows me what the response was for each timestamp. 
  arrange(timestamp)
#Indexed the first and fifth rows which are the first democrat and republican responses ad found the difference between them. 
as.numeric((e$timestamp[1] - e$timestamp[5]) * (-1)) %>%
  round()
```

##Question 1
There were `r a$n` respondents who supported the Democratic candidate.

There were `r b$n[3]-b$n[4]` more respondents who favored the Republican candidate than who were Undecided.

There are two gender variables (gender and gender_combined). There are `r c` individuals for whom these variables have different values.

There are `r d` respondents listed as “White” under race_eth who are not listed as “White” under file_race_black.

The first response of Rep came `r as.numeric((e$timestamp[1] - e$timestamp[5]) * (-1)) %>%
  round()` minutes (rounded to the nearest minute) before the first response of Dem.

##Question 2

```{r make_chart, echo=FALSE, results="asis"}
graphNC <- x %>%
  select(response, race_eth, final_weight) %>%
  group_by(response, race_eth) %>%
  summarize(total = sum(final_weight)) %>%
  filter(race_eth != "[DO NOT READ] Don't know/Refused") %>%
  filter(response != "3") %>%
  spread(key = response, value= total) %>%
  replace_na(list(Und = 0)) %>%
  mutate(all = Dem + Rep + Und + 3) %>% 
  mutate(Dem = Dem / all) %>% 
  mutate(Rep = Rep / all) %>% 
  mutate(Und = Und / all) %>%
  select(-all) %>%
  ungroup() %>%
  mutate(race_eth = fct_relevel(race_eth, c("White", "Black","Hispanic", "Asian", "Other"))) %>% 
  arrange(race_eth) %>%
  gt() %>%
  tab_header(title = "North Carolina 9th Congressional District Polling Results") %>%
   cols_label(
     race_eth = "Race",
     Dem = "DEM",
      Rep = "REP",
      Und = "UND"
      ) %>%
  fmt_percent(columns = vars(Dem, Rep, Und),
                decimals = 0)
graphNC
```


